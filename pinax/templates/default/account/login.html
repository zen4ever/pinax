{% extends "site_base.html" %}

{% load i18n %}
{% load uni_form %}
{% load ifsetting_tag %}

{% block head_title %}{% trans "Login" %}{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}openid-selector/css/openid.css" />
{% endblock %}

{% block body %}
    
    {% if openid and not user.is_authenticated %}
        <p><span class="warning">It appears you have started to login using OpenID. Want to <a href="/openid/register/">finish logging in</a>?</span></p>
    {% endif %}
    
    <h1>{% trans "Log In" %}</h1>
    
    {% if user.is_authenticated %}
        <p><span class="warning">{% trans "Note" %}</span>: {% blocktrans %}you are already logged in as {{ user }}.{% endblocktrans %}</p>
    {% else %}
        {% ifsetting ACCOUNT_OPEN_SIGNUP %}
        {% url acct_signup as signup_url %}
        <p>{% blocktrans %}Don't have an account? <a href="{{ signup_url }}">Sign up</a>!{% endblocktrans %}</p>
        {% endifsetting %}
    {% endif %}
    
    <form class="login uniForm" method="POST" action="">
        <fieldset class="inlineLabels">
            <div class="form_block">
                <a href="{% url acct_passwd_reset %}">{% trans "Forgot password?" %}</a>
            </div>
            {{ form|as_uni_form }}
            <div class="form_block">
                <input type="submit" value="{% trans "Log in &raquo;" %}" />
            </div>
        </fieldset>
    </form>
    
    <p>{% trans "Or sign in with your OpenID" %}:</p>
    {# @@@ why isn't this just does as a form object ? #}
    <!-- Simple OpenID Selector -->
    <form action="/openid/register/" method="POST" id="openid_form">

    <fieldset>
            <legend>Sign-in or Create New Account</legend>
            
            <div id="openid_choice">
                <p>Please click your account provider:</p>
                <div id="openid_btns"></div>
            </div>
            
            <div id="openid_input_area">
                {% if url_required %}
                <ul class="errorlist">
                    <li>This field is required.</li>
                </ul>
                {% endif %}
                <input id="openid_url" name="openid_url" type="text" />
                <input id="openid_submit" type="submit" value="Sign-In"/>
            </div>
            <noscript>
            <p>OpenID is service that allows you to log-on to many different websites using a single indentity.
            Find out <a href="http://openid.net/what/">more about OpenID</a> and <a href="http://openid.net/get/">how to get an OpenID enabled account</a>.</p>
            </noscript>

    </fieldset>
    </form>
    <!-- /Simple OpenID Selector -->
    
    <p>{% blocktrans %}If you have any trouble logging in to your account, contact us at <a href="mailto:{{ CONTACT_EMAIL }}">{{ CONTACT_EMAIL }}</a>.{% endblocktrans %}</p>
{% endblock %}

{% block extra_body %}
<script type="text/javascript" src="{{ STATIC_URL }}openid-selector/js/openid-jquery.js"></script>
<script type="text/javascript">
    $("#id_username").focus();
    openid.img_path = '{{ STATIC_URL }}openid-selector/images/';
    openid.init('openid_url');
</script>
{% endblock %}
